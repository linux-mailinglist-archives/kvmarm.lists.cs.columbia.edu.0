Return-Path: <kvmarm-bounces@lists.cs.columbia.edu>
X-Original-To: lists+kvmarm@lfdr.de
Delivered-To: lists+kvmarm@lfdr.de
Received: from mm01.cs.columbia.edu (mm01.cs.columbia.edu [128.59.11.253])
	by mail.lfdr.de (Postfix) with ESMTP id 442B04668DD
	for <lists+kvmarm@lfdr.de>; Thu,  2 Dec 2021 18:11:02 +0100 (CET)
Received: from localhost (localhost [127.0.0.1])
	by mm01.cs.columbia.edu (Postfix) with ESMTP id 9DBC64B137;
	Thu,  2 Dec 2021 12:11:01 -0500 (EST)
X-Virus-Scanned: at lists.cs.columbia.edu
X-Spam-Flag: NO
X-Spam-Score: 0.909
X-Spam-Level: 
X-Spam-Status: No, score=0.909 required=6.1 tests=[BAYES_00=-1.9,
	DKIM_SIGNED=0.1, DNS_FROM_AHBL_RHSBL=2.699, T_DKIM_INVALID=0.01]
	autolearn=unavailable
Authentication-Results: mm01.cs.columbia.edu (amavisd-new); dkim=softfail
	(fail, message has been altered) header.i=@kernel.org
Received: from mm01.cs.columbia.edu ([127.0.0.1])
	by localhost (mm01.cs.columbia.edu [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id moltrBxZ0Uwn; Thu,  2 Dec 2021 12:11:01 -0500 (EST)
Received: from mm01.cs.columbia.edu (localhost [127.0.0.1])
	by mm01.cs.columbia.edu (Postfix) with ESMTP id 286DB4B20D;
	Thu,  2 Dec 2021 12:11:00 -0500 (EST)
Received: from localhost (localhost [127.0.0.1])
 by mm01.cs.columbia.edu (Postfix) with ESMTP id ECD994B137
 for <kvmarm@lists.cs.columbia.edu>; Thu,  2 Dec 2021 12:10:58 -0500 (EST)
X-Virus-Scanned: at lists.cs.columbia.edu
Received: from mm01.cs.columbia.edu ([127.0.0.1])
 by localhost (mm01.cs.columbia.edu [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id 2EOFQCEAk3sc for <kvmarm@lists.cs.columbia.edu>;
 Thu,  2 Dec 2021 12:10:57 -0500 (EST)
Received: from ams.source.kernel.org (ams.source.kernel.org [145.40.68.75])
 by mm01.cs.columbia.edu (Postfix) with ESMTPS id 15C414B130
 for <kvmarm@lists.cs.columbia.edu>; Thu,  2 Dec 2021 12:10:57 -0500 (EST)
Received: from smtp.kernel.org (relay.kernel.org [52.25.139.140])
 (using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
 (No client certificate requested)
 by ams.source.kernel.org (Postfix) with ESMTPS id 20370B823FB;
 Thu,  2 Dec 2021 17:10:55 +0000 (UTC)
Received: by smtp.kernel.org (Postfix) with ESMTPSA id 238D7C00446;
 Thu,  2 Dec 2021 17:10:51 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=kernel.org;
 s=k20201202; t=1638465053;
 bh=FRmookF9nYEAwWkZ31szXn8ae4AuML7H2xC+7J+E65s=;
 h=From:To:Cc:Subject:Date:From;
 b=iv7pD2zcsYSSp9LZtchap81xKi6GfQQM9YZNXP9EyULBnRsMPXrjDhVODSo83Wsbu
 twYAgkvKVxznULux2k5a1f7M0zxzMFWN1f9wq1SXriwhUCbBxLjn2X+ScJUbkLRkkQ
 WrRn3IG2YhZOyFb3WW1WNgH7BZozvDSQh/C0TfISIEFAZIDFp7PJA3TJoM7RGObEol
 qkIHyPzOMypM0wnUl/FMnJTF++zo6f9zDbrYPL3UvGh1tQ8JZ1uUh1AkegIbr54QqJ
 iTWFTgVS8mt3637jYSh1epQ0y6lgQXjEK+yThCKliIfceoAOg5uJKFvP35q8VX1T6P
 +70NtTcYTEyQQ==
From: Will Deacon <will@kernel.org>
To: kvmarm@lists.cs.columbia.edu
Subject: [PATCH 0/3] KVM: arm64: Keep hyp and host headers separate where
 possible
Date: Thu,  2 Dec 2021 17:10:45 +0000
Message-Id: <20211202171048.26924-1-will@kernel.org>
X-Mailer: git-send-email 2.20.1
MIME-Version: 1.0
Cc: Will Deacon <will@kernel.org>, Marc Zyngier <maz@kernel.org>,
 linux-arm-kernel@lists.infradead.org
X-BeenThere: kvmarm@lists.cs.columbia.edu
X-Mailman-Version: 2.1.14
Precedence: list
List-Id: Where KVM/ARM decisions are made <kvmarm.lists.cs.columbia.edu>
List-Unsubscribe: <https://lists.cs.columbia.edu/mailman/options/kvmarm>,
 <mailto:kvmarm-request@lists.cs.columbia.edu?subject=unsubscribe>
List-Archive: <https://lists.cs.columbia.edu/pipermail/kvmarm>
List-Post: <mailto:kvmarm@lists.cs.columbia.edu>
List-Help: <mailto:kvmarm-request@lists.cs.columbia.edu?subject=help>
List-Subscribe: <https://lists.cs.columbia.edu/mailman/listinfo/kvmarm>,
 <mailto:kvmarm-request@lists.cs.columbia.edu?subject=subscribe>
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: 7bit
Errors-To: kvmarm-bounces@lists.cs.columbia.edu
Sender: kvmarm-bounces@lists.cs.columbia.edu

Hi folks,

This series tidies up the header file usage for the nvhe hyp object so
that header files under arch/arm64/kvm/hyp/include are not included by
host code running at EL1.

For definitions that are shared between the host and hypervisor, these
are either moved to headers under arch/arm64/include/asm/ or are
generated by kbuild along similar lines to asm-offsets.h. For now, this
allows us to tidy up some of the pKVM reserved memory handling, but in
future this will also allow the pKVM EL2 data structures to avoid
polluting the host namespace.

Cheers,

Will

Cc: Alexandru Elisei <alexandru.elisei@arm.com>
Cc: James Morse <james.morse@arm.com>
Cc: Quentin Perret <qperret@google.com>
Cc: Suzuki K Poulose <suzuki.poulose@arm.com>
Cc: Fuad Tabba <tabba@google.com>
Cc: Marc Zyngier <maz@kernel.org>

--->8

Will Deacon (3):
  arm64: Add missing include of asm/cpufeature.h to asm/mmu.h
  KVM: arm64: Generate hyp_constants.h for the host
  KVM: arm64: Move host EL1 code out of hyp/ directory

 arch/arm64/include/asm/kvm_pkvm.h             | 71 +++++++++++++++++++
 arch/arm64/include/asm/mmu.h                  |  1 +
 arch/arm64/kvm/.gitignore                     |  2 +
 arch/arm64/kvm/Makefile                       | 18 ++++-
 arch/arm64/kvm/hyp/Makefile                   |  2 +-
 arch/arm64/kvm/hyp/hyp-constants.c            | 10 +++
 arch/arm64/kvm/hyp/include/nvhe/mm.h          | 57 ---------------
 arch/arm64/kvm/hyp/nvhe/mem_protect.c         |  1 +
 arch/arm64/kvm/hyp/nvhe/mm.c                  |  1 +
 arch/arm64/kvm/hyp/nvhe/setup.c               |  1 +
 arch/arm64/kvm/{hyp/reserved_mem.c => pkvm.c} |  8 +--
 11 files changed, 109 insertions(+), 63 deletions(-)
 create mode 100644 arch/arm64/include/asm/kvm_pkvm.h
 create mode 100644 arch/arm64/kvm/.gitignore
 create mode 100644 arch/arm64/kvm/hyp/hyp-constants.c
 rename arch/arm64/kvm/{hyp/reserved_mem.c => pkvm.c} (94%)

-- 
2.34.0.rc2.393.gf8c9666880-goog

_______________________________________________
kvmarm mailing list
kvmarm@lists.cs.columbia.edu
https://lists.cs.columbia.edu/mailman/listinfo/kvmarm
