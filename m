Return-Path: <kvmarm-bounces@lists.cs.columbia.edu>
X-Original-To: lists+kvmarm@lfdr.de
Delivered-To: lists+kvmarm@lfdr.de
Received: from mm01.cs.columbia.edu (mm01.cs.columbia.edu [128.59.11.253])
	by mail.lfdr.de (Postfix) with ESMTP id C797F47A6B8
	for <lists+kvmarm@lfdr.de>; Mon, 20 Dec 2021 10:18:12 +0100 (CET)
Received: from localhost (localhost [127.0.0.1])
	by mm01.cs.columbia.edu (Postfix) with ESMTP id 1A2BB4B3FE;
	Mon, 20 Dec 2021 04:18:12 -0500 (EST)
X-Virus-Scanned: at lists.cs.columbia.edu
X-Spam-Flag: NO
X-Spam-Score: 0.91
X-Spam-Level: 
X-Spam-Status: No, score=0.91 required=6.1 tests=[BAYES_00=-1.9,
	DKIM_SIGNED=0.1, DNS_FROM_AHBL_RHSBL=2.699, T_DKIM_INVALID=0.01,
	URIBL_BLOCKED=0.001] autolearn=unavailable
Authentication-Results: mm01.cs.columbia.edu (amavisd-new); dkim=softfail
	(fail, message has been altered) header.i=@kernel.org
Received: from mm01.cs.columbia.edu ([127.0.0.1])
	by localhost (mm01.cs.columbia.edu [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id mgW81c6dzLuq; Mon, 20 Dec 2021 04:18:11 -0500 (EST)
Received: from mm01.cs.columbia.edu (localhost [127.0.0.1])
	by mm01.cs.columbia.edu (Postfix) with ESMTP id C823D4B3B8;
	Mon, 20 Dec 2021 04:18:10 -0500 (EST)
Received: from localhost (localhost [127.0.0.1])
 by mm01.cs.columbia.edu (Postfix) with ESMTP id 741034B3EC
 for <kvmarm@lists.cs.columbia.edu>; Mon, 20 Dec 2021 04:18:09 -0500 (EST)
X-Virus-Scanned: at lists.cs.columbia.edu
Received: from mm01.cs.columbia.edu ([127.0.0.1])
 by localhost (mm01.cs.columbia.edu [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id Ncaslsdied1P for <kvmarm@lists.cs.columbia.edu>;
 Mon, 20 Dec 2021 04:18:08 -0500 (EST)
Received: from ams.source.kernel.org (ams.source.kernel.org [145.40.68.75])
 by mm01.cs.columbia.edu (Postfix) with ESMTPS id 43C354B3B8
 for <kvmarm@lists.cs.columbia.edu>; Mon, 20 Dec 2021 04:18:08 -0500 (EST)
Received: from smtp.kernel.org (relay.kernel.org [52.25.139.140])
 (using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
 (No client certificate requested)
 by ams.source.kernel.org (Postfix) with ESMTPS id C5322B80E2D;
 Mon, 20 Dec 2021 09:18:06 +0000 (UTC)
Received: by smtp.kernel.org (Postfix) with ESMTPSA id 8B1CEC36AE5;
 Mon, 20 Dec 2021 09:18:05 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=kernel.org;
 s=k20201202; t=1639991885;
 bh=QT8TE5OZg9xFpKPCWQf7/TdMscTgPU04EByEA7AUTnw=;
 h=Date:From:To:Cc:Subject:In-Reply-To:References:From;
 b=rISuHgPlbqDcAqJ8hAMJDPNXGw0Br2+w9sPz1vUDTVIB/X1R5ZaEVVyOXYTlss/0i
 lxLI1s1stXGzKveHpWcwJ1LIUQLLaTk3rMqvvSuNWX65CSCNRNdvZVEumYnCvOzb5p
 xcp6YI/xvqLkyufZyoszFkrQeOssFI30HjzYqI49ngH+OhGxcSw1EC75WFeeGIxuM6
 2nL8vuFKeXNFwVphPCMSeYgAftG1IG8qnvkMFlO+RHpTdnydZ9wTJaEItr8W7PbTxz
 Rog/2YkUmNHR09KBmIotnoxAzPIu7mQHXXOaeFsgWWdAMfD/0C9bBlXdLGsNwun18y
 7WdHHHhdUYCRg==
Received: from cfbb000407.r.cam.camfibre.uk ([185.219.108.64]
 helo=why.misterjones.org)
 by disco-boy.misterjones.org with esmtpsa (TLS1.3) tls
 TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384 (Exim 4.94.2)
 (envelope-from <maz@kernel.org>)
 id 1mzEnz-00DFJn-I5; Mon, 20 Dec 2021 09:18:03 +0000
Date: Mon, 20 Dec 2021 09:18:03 +0000
Message-ID: <87k0fzws6s.wl-maz@kernel.org>
From: Marc Zyngier <maz@kernel.org>
To: Ganapatrao Kulkarni <gankulkarni@os.amperecomputing.com>
Subject: Re: [PATCH v5 29/69] KVM: arm64: nv: Respect the virtual HCR_EL2.NV
 bit setting
In-Reply-To: <c9e1cae5-ded4-d4e5-e60e-2e2044800ad1@os.amperecomputing.com>
References: <20211129200150.351436-1-maz@kernel.org>
 <20211129200150.351436-30-maz@kernel.org>
 <c9e1cae5-ded4-d4e5-e60e-2e2044800ad1@os.amperecomputing.com>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI-EPG/1.14.7 (Harue)
 FLIM-LB/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL-LB/10.8 EasyPG/1.0.0 Emacs/27.1
 (x86_64-pc-linux-gnu) MULE/6.0 (HANACHIRUSATO)
MIME-Version: 1.0 (generated by SEMI-EPG 1.14.7 - "Harue")
X-SA-Exim-Connect-IP: 185.219.108.64
X-SA-Exim-Rcpt-To: gankulkarni@os.amperecomputing.com,
 linux-arm-kernel@lists.infradead.org, kvmarm@lists.cs.columbia.edu,
 kvm@vger.kernel.org, andre.przywara@arm.com, christoffer.dall@arm.com,
 jintack@cs.columbia.edu, haibo.xu@linaro.org, james.morse@arm.com,
 suzuki.poulose@arm.com, alexandru.elisei@arm.com, kernel-team@android.com
X-SA-Exim-Mail-From: maz@kernel.org
X-SA-Exim-Scanned: No (on disco-boy.misterjones.org);
 SAEximRunCond expanded to false
Cc: kernel-team@android.com, kvm@vger.kernel.org,
 Andre Przywara <andre.przywara@arm.com>,
 Christoffer Dall <christoffer.dall@arm.com>, kvmarm@lists.cs.columbia.edu,
 linux-arm-kernel@lists.infradead.org
X-BeenThere: kvmarm@lists.cs.columbia.edu
X-Mailman-Version: 2.1.14
Precedence: list
List-Id: Where KVM/ARM decisions are made <kvmarm.lists.cs.columbia.edu>
List-Unsubscribe: <https://lists.cs.columbia.edu/mailman/options/kvmarm>,
 <mailto:kvmarm-request@lists.cs.columbia.edu?subject=unsubscribe>
List-Archive: <https://lists.cs.columbia.edu/pipermail/kvmarm>
List-Post: <mailto:kvmarm@lists.cs.columbia.edu>
List-Help: <mailto:kvmarm-request@lists.cs.columbia.edu?subject=help>
List-Subscribe: <https://lists.cs.columbia.edu/mailman/listinfo/kvmarm>,
 <mailto:kvmarm-request@lists.cs.columbia.edu?subject=subscribe>
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: 7bit
Errors-To: kvmarm-bounces@lists.cs.columbia.edu
Sender: kvmarm-bounces@lists.cs.columbia.edu

On Mon, 20 Dec 2021 07:11:03 +0000,
Ganapatrao Kulkarni <gankulkarni@os.amperecomputing.com> wrote:
> 
> Hi Marc,
> 
> On 30-11-2021 01:31 am, Marc Zyngier wrote:
> > From: Jintack Lim <jintack.lim@linaro.org>
> > 
> > Forward traps due to HCR_EL2.NV bit to the virtual EL2 if they are not
> > coming from the virtual EL2 and the virtual HCR_EL2.NV bit is set.
> > 
> > In addition to EL2 register accesses, setting NV bit will also make EL12
> > register accesses trap to EL2. To emulate this for the virtual EL2,
> > forword traps due to EL12 register accessses to the virtual EL2 if the
> > virtual HCR_EL2.NV bit is set.
> > 
> > This is for recursive nested virtualization.
> 
> What is recursive nested virtualization means?
> Are we going to set NV/NV1/NV2 bits of ID_AA64MMFR2_EL1 of
> Guest-Hypervisor to support NV in Guest-Hypervisor?

Of course. An implementation of nested virtualisation that would stop
at L1 would be pretty crap and fail to live up to the 'turtles all the
way down' paradigm.

Note that the recursive support is still a work in progress, as making
it work for real in a software model is an exercise in futility (for
example, we make no effort to make the VNCR_EL2 mapping work past L1).

Once someone sends me a NV-capable box, I'll get it working.

	M.

-- 
Without deviation from the norm, progress is not possible.
_______________________________________________
kvmarm mailing list
kvmarm@lists.cs.columbia.edu
https://lists.cs.columbia.edu/mailman/listinfo/kvmarm
