Return-Path: <kvmarm-bounces@lists.cs.columbia.edu>
X-Original-To: lists+kvmarm@lfdr.de
Delivered-To: lists+kvmarm@lfdr.de
Received: from mm01.cs.columbia.edu (mm01.cs.columbia.edu [128.59.11.253])
	by mail.lfdr.de (Postfix) with ESMTP id 32A24DDE18
	for <lists+kvmarm@lfdr.de>; Sun, 20 Oct 2019 12:25:36 +0200 (CEST)
Received: from localhost (localhost [127.0.0.1])
	by mm01.cs.columbia.edu (Postfix) with ESMTP id B10CE4AC1C;
	Sun, 20 Oct 2019 06:25:35 -0400 (EDT)
X-Virus-Scanned: at lists.cs.columbia.edu
X-Spam-Flag: NO
X-Spam-Score: 0.799
X-Spam-Level: 
X-Spam-Status: No, score=0.799 required=6.1 tests=[BAYES_00=-1.9,
	DNS_FROM_AHBL_RHSBL=2.699] autolearn=unavailable
Received: from mm01.cs.columbia.edu ([127.0.0.1])
	by localhost (mm01.cs.columbia.edu [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id cuEGSusRAYM1; Sun, 20 Oct 2019 06:25:35 -0400 (EDT)
Received: from mm01.cs.columbia.edu (localhost [127.0.0.1])
	by mm01.cs.columbia.edu (Postfix) with ESMTP id A617B4AC0C;
	Sun, 20 Oct 2019 06:25:34 -0400 (EDT)
Received: from localhost (localhost [127.0.0.1])
 by mm01.cs.columbia.edu (Postfix) with ESMTP id 63FE84AA46
 for <kvmarm@lists.cs.columbia.edu>; Sun, 20 Oct 2019 06:25:33 -0400 (EDT)
X-Virus-Scanned: at lists.cs.columbia.edu
Received: from mm01.cs.columbia.edu ([127.0.0.1])
 by localhost (mm01.cs.columbia.edu [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id FBE1zs38b36m for <kvmarm@lists.cs.columbia.edu>;
 Sun, 20 Oct 2019 06:25:32 -0400 (EDT)
Received: from inca-roads.misterjones.org (inca-roads.misterjones.org
 [213.251.177.50])
 by mm01.cs.columbia.edu (Postfix) with ESMTPS id 407D14AA12
 for <kvmarm@lists.cs.columbia.edu>; Sun, 20 Oct 2019 06:25:32 -0400 (EDT)
Received: from 78.163-31-62.static.virginmediabusiness.co.uk ([62.31.163.78]
 helo=big-swifty.misterjones.org)
 by cheepnis.misterjones.org with esmtpsa (TLSv1.2:AES256-GCM-SHA384:256)
 (Exim 4.80) (envelope-from <maz@kernel.org>)
 id 1iM8Ot-0002G3-V4; Sun, 20 Oct 2019 12:25:29 +0200
Date: Sun, 20 Oct 2019 11:25:24 +0100
Message-ID: <865zkjzpbf.wl-maz@kernel.org>
From: Marc Zyngier <maz@kernel.org>
To: Christoffer Dall <christoffer.dall@arm.com>
Subject: Re: [PATCH v3 0/2] Improve handling of stage 2 aborts without
 instruction decode
In-Reply-To: <20191011110709.2764-1-christoffer.dall@arm.com>
References: <20191011110709.2764-1-christoffer.dall@arm.com>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI-EPG/1.14.7 (Harue)
 FLIM/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL/10.8 EasyPG/1.0.0 Emacs/26
 (aarch64-unknown-linux-gnu) MULE/6.0 (HANACHIRUSATO)
MIME-Version: 1.0 (generated by SEMI-EPG 1.14.7 - "Harue")
X-SA-Exim-Connect-IP: 62.31.163.78
X-SA-Exim-Rcpt-To: christoffer.dall@arm.com, kvmarm@lists.cs.columbia.edu,
 james.morse@arm.com, julien.thierry.kdev@gmail.com, suzuki.poulose@arm.com,
 linux-arm-kernel@lists.infradead.org, graf@amazon.com, berrange@redhat.com,
 xypron.glpk@gmx.de, stefanha@redhat.com, peter.maydell@linaro.org
X-SA-Exim-Mail-From: maz@kernel.org
X-SA-Exim-Scanned: No (on cheepnis.misterjones.org);
 SAEximRunCond expanded to false
Cc: =?UTF-8?B?IkRhbmllbCBQLiBCZXJyYW5nw6ki?= <berrange@redhat.com>,
 Heinrich Schuchardt <xypron.glpk@gmx.de>,
 Stefan Hajnoczi <stefanha@redhat.com>, kvmarm@lists.cs.columbia.edu,
 linux-arm-kernel@lists.infradead.org
X-BeenThere: kvmarm@lists.cs.columbia.edu
X-Mailman-Version: 2.1.14
Precedence: list
List-Id: Where KVM/ARM decisions are made <kvmarm.lists.cs.columbia.edu>
List-Unsubscribe: <https://lists.cs.columbia.edu/mailman/options/kvmarm>,
 <mailto:kvmarm-request@lists.cs.columbia.edu?subject=unsubscribe>
List-Archive: <https://lists.cs.columbia.edu/pipermail/kvmarm>
List-Post: <mailto:kvmarm@lists.cs.columbia.edu>
List-Help: <mailto:kvmarm-request@lists.cs.columbia.edu?subject=help>
List-Subscribe: <https://lists.cs.columbia.edu/mailman/listinfo/kvmarm>,
 <mailto:kvmarm-request@lists.cs.columbia.edu?subject=subscribe>
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: 7bit
Errors-To: kvmarm-bounces@lists.cs.columbia.edu
Sender: kvmarm-bounces@lists.cs.columbia.edu

Hi Christoffer,

On Fri, 11 Oct 2019 12:07:04 +0100,
Christoffer Dall <christoffer.dall@arm.com> wrote:
> 
> When a guest accesses memory outside the memory slots, KVM usually
> bounces the access back to userspace with KVM_EXIT_MMIO.  However, on
> arm/arm64 systems, certain load/store instructions did not provide
> decoding info for the hypervisor to emulate the instruction, and in this
> case KVM has rather rudely returned -ENOSYS and printed a not overly
> helpful error message:
> 
>   load/store instruction decoding not implemented
> 
> This patch series improves the error message and allows userspace to be
> notified of this event instead of receiving -ENOSYS, and also allows
> userspace to ask KVM to inject an external abort to the guest, which it
> can use for any memory access that it either cannot handle.
> 
> One remaining case which this patch set does not address is if the guest
> accesses an in-kernel emulated device, such as the VGIC, but using a
> load/store instruction which doesn't provide decode info.  With these
> patches, this will return to userspace for it to handle, but there's no
> way for userspace to return the decoding information to KVM and have KVM
> complete the access to the in-kernel emulated device.  I have no plans
> to address this limitation.

You had some pending comments on patch 2, and you seem to indicate
that you would respin the series. Do you have plans to do so in the
coming days? I'd like to put that series into -next, but I can either
wait for your respin, or queue it as it is and apply fixes on top.

Please let me know what you prefer.

Thanks,

	M.

-- 
Jazz is not dead, it just smells funny.
_______________________________________________
kvmarm mailing list
kvmarm@lists.cs.columbia.edu
https://lists.cs.columbia.edu/mailman/listinfo/kvmarm
